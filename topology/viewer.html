<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <style>

@import "/css/style.css";
@import "/css/fa.css";

body {
    position: fixed; top: 0; right: 0; bottom: 0; left: 0;
    padding: 0; margin: 0;
    /*background: #ffffff url("/img/bg_signin.png") no-repeat center center fixed;
	background-size: cover;*/
}
/*
body:not(.background)::before {
	content: "";
	position: absolute; top: 0; right: 0; bottom: 0; left: 0;
	background-color: rgba(0, 0, 0, 0.8);
	z-index: -1;
}
*/
nav {
    position: absolute; inset: 0 0 auto 0;
    padding: 5px;
    display: flex; justify-content: space-between;
    font: 20px "Font Awesome 5 Free";
    color: #ffffff;
    user-select: none;
}

nav span {
    border-radius: 50%;
    display: inline-flex;
    width: 32px; height: 32px;
    align-items: center;
    justify-content: center;
    background-color: rgba(0, 132, 255, 0.5);
    border-color: #0084ff;
    cursor: pointer;
}

nav span:hover {
    background-color: #0084ff;
}

svg {
    width: 100%; height: 100%;
}

.node * {
    pointer-events: none;
}

.node image {
    pointer-events: all;
}

.node circle {
	stroke: none;
	fill: none;
}

.node.critical circle {
	stroke: rgba(255, 170, 0, 0.3);
    fill: rgba(255, 170, 0, 0.6);
	animation: status 2s infinite;
}

.node.shutdown circle {
	stroke: rgba(255, 0, 0, 0.3);
    fill: rgba(255, 0, 0, 0.6);
	animation: status 2s infinite;
}

polyline {
    fill: none;
    stroke-dasharray: 5px;
    animation: flow 0.5s infinite linear;
}

.path circle {
    fill: #dddddd;
}

.path text {
    cursor: pointer;
    fill: #fcba30;
}

iframe {
    border: none;
    width: 100%; height: 100%;
}

#dialog {
	position: fixed; top: 0; right: 0; bottom: 0; left: 0;
	padding: 0; margin: 0;
    z-index: 3;
}

.loading.mask {
    z-index: 9;
}

@keyframes status {
	from {
    	stroke-opacity: 0;
    }
    to {
    	stroke-opacity: 1;
    }
}

@keyframes flow {
    to {
        stroke-dashoffset: 10px;
    }
}

text {
    font: 12px tahoma, arial, "맑은 고딕";
    text-anchor: middle;
    fill: #ffffff;
}

body:not(.label) .node tspan,
body.name .node tspan:last-child,
body:not(.name) .node tspan:first-child,
body:not(.exit) #exit,
body:not(.dialog) #dialog,
body:not(.frame) .frame {
	display: none;
}
            </style>
            <script>

function Display () {
    document.body.classList.add("label", "name");
    
    const action = [
        () => document.body.classList.toggle("name"),
        () => document.body.classList.toggle("label"),
        () => {
            document.body.classList.toggle("name");
            document.body.classList.toggle("label");
        }
    ];

    var i = 0;

    this.update = e => {
        action[i++ %3]();
    }
}

function showDialog(src, parent) {
    const dialog = document.getElementById("dialog");

    dialog.onload = function () {
        $.parent = parent;

		document.body.classList.add("dialog");
	};

    dialog.src = src;
}

function closeDialog(reset) {
    document.body.classList.remove("dialog");
    
    if (reset) {
        resetParent();
    }

    delete $.parent;
}

function resetParent() {
    $.parent && $.parent.location.reload();
}

function showChart(id, index) {
    switch (arguments.length) {
    case 1:
        top.showDialog(`/chart.html?id=${id}`);

        break;
    case 2:
        top.showDialog(`/chart.html?id=${id}&chart=/chart/throughput.html&index=${index}`);

        break;
    }
}

function onSearch (e) {
    const keyword = prompt("노드 이름 또는 IP주소를 입력하세요.");
    
    if (!keyword) {
        return;
    }

    var
        found = false,
        node;

    for (let id in parent.branchData) {
        node = parent.branchData[id];

        if (keyword === node.ip || keyword === node.name) {
            parent.moveStage(parent.positionData[id].parent, id);
            
            found = true;

            break;
        }
    }

    if (!found) {
        for (let id in parent.nodeData) {
            node = parent.nodeData[id];

            if (keyword === node.ip || keyword === node.name) {
                parent.moveStage(parent.positionData[id].parent, id);
                
                found = true;

                break;
            }
        }
    }

    if (!found) {
        alert("Information.\n\n검색 결과가 없습니다.");
    }
}

function showMessage(xhr) {
    switch (xhr.status) {
    case 401:
        alert(NOTICE_SESS_EXPIRE["kr"]);

        break;
    default:
        alert(ERROR_RES_CODE(xhr.status)["kr"]);
    }

    try {
        console.log(JSON.parse(xhr.responseText).error);
    } catch (e) {}
}

            </script>
        </head>
        
        <body class="label name loading">
            <nav>
                <div>
                    <span title="라벨 표시" id="display">
                        &#xf074;
                    </span>
                    <span title="노드 찾기" id="search">
                        &#xf002;
                    </span>
                    <span title="상위 이동" id="exit">
                        &#xf2f5;
                    </span>
                </div>
                <div class="frame">
                    <span id="popup" title="새 창">&#xf2d2;</span>
                </div>
            </nav>
            <iframe id="dialog" name="dialog"></iframe>
            <div class="loading mask"></div>

            <script src="/js/ITAhM.js"></script>
            <script src="/js/snmp.js"></script>
            <script src="/js/icon.js"></script>
            <script src="/topology/viewer.js"></script>
            <script src="/js/request.js"></script>
            <script src="/js/constants.js"></script>
            <script>
const
    search = new URLSearchParams(window.location.search),
    $ = {
        request: new Request(),
        iconData: ITAhM.iconData,
        branch: Number(search.get("group")) || undefined,
        focus: Number(search.get("focus")) || undefined,
        display: new Display(),
        pathMap: {},
        deviceMap: {}
    };

document.getElementById("display").onclick = e => $.display.update();
document.getElementById("search").onclick = onSearch;

if ("display" in parent.settingData && parent.settingData.display === "address") {
    document.body.classList.remove("name");
}

initialize($.branch, parent);

if ($.branch) {
    document.getElementById("exit").onclick = e => parent.moveStage(parent.positionData[$.branch].parent);

    document.body.classList.add("exit");
}

document.body.classList.remove("loading");

$.focus && focusNode($.focus);

        </script>
    </body>
</html>